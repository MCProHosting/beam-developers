extends ./layouts/main.pug
block title
    | RESTful API documentation
block additionalMetas
    meta(
        http-equiv="X-UA-Compatible"
        content="IE=edge"
    )

block additionalStyles
    link(
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css"
    )
    style.

    block additionalScripts
    script(
        type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js"
    )
block content
    h1
        OAuth
    div
    section
        h1 Beam OAuth
        section
            ul
                li
                    | Authorize endpoint:
                    code https://beam.pro/oauth/authorize
                li
                    | Token endpoint:
                    code https://beam.pro/api/v1/oauth/token
        section
            h2 Introduction
            p
                | If you want to act as another user in chat, access a users' private resources as part of your app,
                | or just want to use Beam credentials to authenticate your users, it's best to use OAuth so the users'
                | credentials don't need to be stored on your servers.
            p
                | OAuth is a system that replaces traditional user/password combos with app-specific tokens. Your app
                | can request a set of tokens for a certain user with a specific set of permissions. This way your app
                | only gets access to what it needs and all other details will stay hidden. It's a win-win scenario for
                | both your app's functionality, and our user's privacy.
            p
                | To start using OAuth create an application as described below.
        section
            h2 Registering your application
            p
                | To create an application head over to the
                a(href='/oauth/manage') Manage OAuth
                |    page!
                |                 (You may need to authorize the developers site first). Once there, click the
                code Create New
                |                 button in the top right corner and it'll open the creation form.
            p
                | On this page you'll need to enter some basic details about your application, like its name, website and
                | logo. All of these details will be displayed publically to users of your app.
            h3 Hosts
            p
                | The hosts parameter is an important one; it tells us what domains your application can redirect to.
                | This should be set to domains you control. You can use wildcards, for example:
                code *.beam.pro
                |                 will allow redirects to all subdomains on beam.pro, but not beam.pro itself. The list of domains is
                |                 comma separated if you want to add multiple ones.
        section
            h2 Using OAuth
            p
                | The OAuth 2.0 protocol is simple enough, but that doesn't mean you should implement it from scratch.
                | Most popular languages will have a library to easily interface with an OAuth server.
            p
                | If you're interested in reading an in depth explanation of how OAuth works head
                a(href='https://aaronparecki.com/articles/2012/07/29/1/oauth2-simplified', target='_blank') here
                | .
            p
                | To use our OAuth implementation you'll just need a few details which can be found at the top of the page
                | and on your
                a(href='/oauth/manage') Manage OAuth
                |    page.
        section
            h2 OAuth Scopes
            p
                | To request access to a users' account you need to use scopes. Scopes limit the amount of access a certain
                | application has to the account. Below are all the scopes you can use. If you're requesting multiple, make
                | sure to use spaces in between them!
            table.table.table-condensed
                thead
                    tr
                        th.
                            Permission name
                        th.
                            Permission description
                tbody
                    each permData, permName in permissions
                        unless permData.administrative
                            tr
                                td=permName
                                td=permData.text
    include ../../temp/rest.html
    script(
        type="text/javascript"
    ).
        $(document).ready(function() {
            $('.page-header pre code, .top-resource-description pre code').each(function(i, block) {
              hljs.highlightBlock(block);
            });

            $('[data-toggle]').click(function() {
              var selector = $(this).data('target') + ' pre code';
              $(selector).each(function(i, block) {
                    hljs.highlightBlock(block);
              });
            });

            // open modal on hashes like #_action_get
            $(window).bind('hashchange', function(e) {
              var anchor_id = document.location.hash.substr(1); //strip #
              var element = $('#' + anchor_id);

              // do we have such element + is it a modal?  --> show it
              if (element.length && element.hasClass('modal')) {
                    element.modal('show');
              }
            });

            // execute hashchange on first page load
            $(window).trigger('hashchange');

            // remove url fragment on modal hide
            $('.modal').on('hidden.bs.modal', function() {
              try {
                    if (history && history.replaceState) {
                        history.replaceState({}, '', '#');
                    }
              } catch(e) {}
            });
        });
